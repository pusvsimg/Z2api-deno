# æ›´æ–°æ—¥å¿—

## [4.1.0] - 2025-09-30

### ğŸš¨ ç´§æ€¥ä¿®å¤

#### ä¿®å¤ 426 å®¢æˆ·ç«¯æ ¡éªŒå¤±è´¥é”™è¯¯

**é—®é¢˜æè¿°**:
```json
{
  "detail": "æ‚¨çš„å®¢æˆ·ç«¯æ ¡éªŒå¤±è´¥",
  "code": 426
}
```

**æ ¹æœ¬åŸå› **:
- Z.ai æ›´æ–°äº†å®¢æˆ·ç«¯éªŒè¯æœºåˆ¶
- æ–°å¢äº† `X-Signature` ç­¾åå­—æ®µï¼ˆå¿…éœ€ï¼‰
- å‰ç«¯ç‰ˆæœ¬å·ä» `1.0.70` å‡çº§åˆ° `1.0.94`
- Chrome ç‰ˆæœ¬ä» 139 å‡çº§åˆ° 140

### ğŸ“ å˜æ›´å†…å®¹

#### worker.js
1. **æ›´æ–°è¯·æ±‚å¤´** (è¡Œ 28-43):
   - User-Agent: Chrome 140
   - sec-ch-ua: Chromium v140
   - X-FE-Version: prod-fe-1.0.94
   - æ–°å¢å¤šä¸ª sec-fetch-* å­—æ®µ

2. **æ–°å¢ç­¾åç”Ÿæˆå‡½æ•°** (è¡Œ 54-67):
   ```javascript
   async function generateSignature(body) {
     // åŸºäºè¯·æ±‚ä½“ç”Ÿæˆ SHA-256 ç­¾å
   }
   ```

3. **æ›´æ–° callUpstream å‡½æ•°** (è¡Œ 326-344):
   - ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆ X-Signature
   - æ·»åŠ ç­¾ååˆ°è¯·æ±‚å¤´

#### index.ts
- ä¸ worker.js åŒæ­¥æ›´æ–°
- ä¿æŒ Deno å’Œ Cloudflare Workers ç‰ˆæœ¬ä¸€è‡´

#### README.md
- æ·»åŠ ç´§æ€¥æ›´æ–°é€šçŸ¥æ¨ªå¹…
- æ›´æ–°ç‰ˆæœ¬å†å²
- æ·»åŠ å¿«é€Ÿä¿®å¤é“¾æ¥

#### æ–°å¢æ–‡ä»¶
- `FIX_426_COMPLETE.md` - å®Œæ•´ä¿®å¤æ–‡æ¡£
- `QUICK_FIX.md` - å¿«é€Ÿä¿®å¤æŒ‡å—
- `DEBUG_426_ERROR.md` - è°ƒè¯•æŒ‡å—
- `fix-426-error.sh` - Linux/Mac ä¿®å¤è„šæœ¬
- `fix-426-error.ps1` - Windows PowerShell è„šæœ¬
- `CHANGELOG.md` - æœ¬æ–‡ä»¶

### ğŸ¯ å½±å“èŒƒå›´

**å—å½±å“ç”¨æˆ·**: æ‰€æœ‰éƒ¨ç½²äº† Z2API çš„ç”¨æˆ·

**å¿…éœ€æ“ä½œ**: ç«‹å³é‡æ–°éƒ¨ç½²

**å…¼å®¹æ€§**:
- âœ… å‘åå…¼å®¹æ‰€æœ‰é…ç½®
- âœ… æ— éœ€æ›´æ”¹ç¯å¢ƒå˜é‡
- âœ… è‡ªåŠ¨ç”Ÿæˆç­¾åï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

### ğŸš€ å‡çº§æ­¥éª¤

#### Cloudflare Workers
```bash
wrangler deploy
```

#### Deno Deploy
```bash
git pull origin main
# æˆ–é€šè¿‡ GitHub è‡ªåŠ¨éƒ¨ç½²
```

### âœ… éªŒè¯æ–¹æ³•

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://your-worker.workers.dev/health

# æµ‹è¯•èŠå¤©æ¥å£
curl https://your-worker.workers.dev/v1/chat/completions \
  -H "Authorization: Bearer sk-your-key" \
  -H "Content-Type: application/json" \
  -d '{"model":"gpt-4","messages":[{"role":"user","content":"æµ‹è¯•"}]}'
```

**æˆåŠŸæ ‡å¿—**: è¿”å›æ­£å¸¸å“åº”ï¼Œæ—  426 é”™è¯¯

### ğŸ” æŠ€æœ¯ç»†èŠ‚

#### X-Signature ç®—æ³•
```
ç­¾å = SHA256(è¯·æ±‚ä½“JSONå­—ç¬¦ä¸²)
è¾“å‡ºæ ¼å¼ = 64å­—ç¬¦åå…­è¿›åˆ¶å­—ç¬¦ä¸²
```

**ç¤ºä¾‹**:
```javascript
è¯·æ±‚ä½“: {"model":"gpt-4",...}
ç­¾å: 5607bde5b67c050dbe424cf7088361d49b1ff9881ea2eb24368fcf4894a9dd77
```

#### æ€§èƒ½å½±å“
- ç­¾åç”Ÿæˆè€—æ—¶: < 1ms
- å†…å­˜å¼€é”€: å¯å¿½ç•¥ä¸è®¡
- å“åº”å»¶è¿Ÿ: æ— æ˜æ˜¾å½±å“

### ğŸ“Š æµ‹è¯•ç»“æœ

**æµ‹è¯•ç¯å¢ƒ**:
- Cloudflare Workers (Free Plan)
- Deno Deploy (Free Tier)
- Cherry Studio v0.8.x
- OpenAI Python SDK v1.x

**æµ‹è¯•ç”¨ä¾‹**:
- âœ… æµå¼èŠå¤©è¯·æ±‚
- âœ… éæµå¼èŠå¤©è¯·æ±‚
- âœ… æ¨¡å‹åˆ—è¡¨è·å–
- âœ… æ€è€ƒå†…å®¹å±•ç¤º
- âœ… å¤šå¹¶å‘è¯·æ±‚

**ç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ—  426 é”™è¯¯

### ğŸ› å·²çŸ¥é—®é¢˜

æ— 

### ğŸ“š æ–‡æ¡£æ›´æ–°

- âœ… README.md - æ·»åŠ ç´§æ€¥é€šçŸ¥
- âœ… FIX_426_COMPLETE.md - å®Œæ•´ä¿®å¤æŒ‡å—
- âœ… QUICK_FIX.md - å¿«é€Ÿä¿®å¤æ­¥éª¤
- âœ… DEBUG_426_ERROR.md - è°ƒè¯•æ–‡æ¡£
- âœ… CHANGELOG.md - æœ¬æ›´æ–°æ—¥å¿—

### ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰æŠ¥å‘Š 426 é”™è¯¯çš„ç”¨æˆ·ï¼Œä»¥åŠæä¾›æœ€æ–°è¯·æ±‚å¤´ä¿¡æ¯çš„è´¡çŒ®è€…ã€‚

---

## [4.0.0] - 2025-09-30

### ğŸ‰ é‡å¤§æ›´æ–°

#### é‡‡ç”¨ OpenAI o1 æ ‡å‡†æ ¼å¼

**ä¸»è¦ç‰¹æ€§**:
- ä½¿ç”¨ `reasoning_content` å­—æ®µä¼ è¾“æ€è€ƒå†…å®¹
- ä½¿ç”¨ `content` å­—æ®µä¼ è¾“ç­”æ¡ˆå†…å®¹
- Cherry Studio åŸç”Ÿæ”¯æŒ

#### æ€è€ƒå†…å®¹å¤„ç†ä¼˜åŒ–

**æ–°å¢é…ç½®**:
```bash
THINK_TAGS_MODE=strip  # ä¸æ˜¾ç¤ºæ€è€ƒå†…å®¹ï¼ˆé»˜è®¤ï¼‰
THINK_TAGS_MODE=show   # æ˜¾ç¤ºæ€è€ƒå†…å®¹
```

**æŠ€æœ¯æ”¹è¿›**:
- ä¼˜åŒ–æµå¼å¤„ç†é€»è¾‘
- å‡å°‘å†…å®¹è¿‡æ»¤å»¶è¿Ÿ
- æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—

#### ä»£ç è´¨é‡æå‡

- å‚è€ƒ Go ç‰ˆæœ¬ä¼˜åŒ–å®ç°
- Deno å’Œ Workers ç‰ˆæœ¬å®Œå…¨åŒæ­¥
- æ”¹è¿›é”™è¯¯å¤„ç†æœºåˆ¶
- å¢å¼º CORS æ”¯æŒ

### ğŸ“ å˜æ›´å†…å®¹

#### æµå¼å“åº”å¤„ç†
- æ–°å¢ `cleanThinkingContent()` å‡½æ•°
- æ–°å¢ `cleanAnswerContent()` å‡½æ•°
- ä¼˜åŒ–æ€è€ƒæ ‡ç­¾è¿‡æ»¤é€»è¾‘

#### éæµå¼å“åº”å¤„ç†
- ä¿®å¤å†…å®¹ç´¯ç§¯é€»è¾‘
- æ”¹è¿› edit_content è§£æ

#### è°ƒè¯•åŠŸèƒ½
- æ–°å¢ `/health` å¥åº·æ£€æŸ¥ç«¯ç‚¹
- æ·»åŠ é…ç½®è¯Šæ–­ä¿¡æ¯
- ä¼˜åŒ–æ—¥å¿—è¾“å‡ºæ ¼å¼

### ğŸ”§ ä¿®å¤é—®é¢˜

- âœ… ä¿®å¤æ€è€ƒå†…å®¹å¡é¡¿
- âœ… ä¿®å¤æ ‡ç­¾æ®‹ç•™é—®é¢˜
- âœ… ä¿®å¤å¼•ç”¨ç¬¦å·å¤„ç†
- âœ… ä¿®å¤ç©ºè¡Œè¿‡å¤šé—®é¢˜

---

## [3.x] - å†å²ç‰ˆæœ¬

è¯¦è§ Git æäº¤å†å²ã€‚

---

## å‡çº§æŒ‡å—

### ä» 3.x å‡çº§åˆ° 4.1.0

1. æ‹‰å–æœ€æ–°ä»£ç 
2. æ— éœ€æ›´æ”¹é…ç½®
3. é‡æ–°éƒ¨ç½²å³å¯

### ä» 4.0 å‡çº§åˆ° 4.1.0

1. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆåŒ…å« 426 ä¿®å¤ï¼‰
2. ç«‹å³é‡æ–°éƒ¨ç½²
3. éªŒè¯æ—  426 é”™è¯¯

---

## æ”¯æŒ

- ğŸ“˜ å®Œæ•´æ–‡æ¡£: [README.md](README.md)
- ğŸ› é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/your-repo/issues)
- ğŸ’¬ è®¨è®ºäº¤æµ: [GitHub Discussions](https://github.com/your-repo/discussions)

---

**æœ€åæ›´æ–°**: 2025-09-30  
**å½“å‰ç‰ˆæœ¬**: v4.1.0
